<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet"href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="stylesheets/stylesheet.css">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
        <link rel="icon" href="images/e082ab48525a4777b19a68eb18d6bd6f - Copy.png">

        <title>Moda - Products</title>

    </head>

    <body>
        <!-- naavigation bar -->
        <nav class="navbar navbar-expand-lg navbar-light">
            <a class="navbar-brand mr-4 mb-2" href="/">
                <img src="images/e082ab48525a4777b19a68eb18d6bd6f.png" alt="Moda Logo">
            </a>
            <!-- button that appears when window width get smaller -->
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <!-- navigation bar content -->
            <div class="collapse navbar-collapse" id="navbarNavDropdown">
                <ul class="navbar-nav ">
                    <li class="nav-item ml-4 pl-4 pr-4">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item ml-4 pl-4 pr-4">
                        <a class="nav-link" href="/products">Products</a>
                    </li>
                    <li class="nav-item ml-4 pl-4 pr-4">
                        <a class="nav-link" href="/about">About</a>
                    </li>
                    <!-- navigation bar content that dropdowns for more options -->
                    <li class="nav-item dropdown ml-4 pl-4 pr-4">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            More
                        </a>
                        <div class="dropdown-menu mb-4" aria-labelledby="navbarDropdown">
                            <!-- changes the conent inside the dropdown depending on whether you are loggged in or not -->
                            <% if (myVar == 0) { %>
                                <a class="dropdown-item" href="/register">Register      <i class="fas fa-user-plus ml-3"></i></a></a>
                                <a class="dropdown-item" href="/login">Login     <i class="fas fa-sign-in-alt ml-3"></i></a></a>
                            <% } %>
                            <% if (myVar == 1) { %>
                                <a class="dropdown-item" href="/profile">Profile     <i class="fas fa-user-circle ml-3"></i></a></a>
                                <a class="dropdown-item" href="/checkout">Checkout       <i class="fas fa-shopping-basket ml-3"></i></a></a>
                                <a class="dropdown-item" href="/logout">Logout        <i class="fas fa-sign-out-alt ml-3"></i></a></a>
                            <% } %>
                        </div>
                      </li>
                </ul>
            </div>
        </nav>

    <!-- alert appears if the priduct has been added to cart -->
    <% if (messages.success) { %>
        <div class="alert alert-success alert-dismissible fade show"><%- messages.success %>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
        </div>
    <% } %>

       <!-- filter tab  -->
        <div class="navbar navbar-expand-lg p-3" id="navbar2">
            <div class="nav-link dropdown-toggle  mt-3 mb-3 text-white text-left w-100" id="filtermain" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
               <label>Filter      <i class="fas fa-filter"></i></label> 
            </div>
            <!-- filter div dropdown contains all the different filers -->
            <div class="dropdown-menu mb-4 w-100 " aria-labelledby="filtermain" id="filterdropmenu">
                <div class="list-group-item text-white mt-4">
                    <!-- simple search bar to search all products -->
                    <label for="myInput" class="form-label"><b>What are you looking for:</b></label>
                    <input class="form-control warning text-muted border-0 rounded-pill w-50 mt-2" id="myInput" type="text" placeholder="Search our lines...">
                </div>
                <div class="list-group-item text-white mt-4 ">
                    <!-- the filetr buttons to filetr products by size -->
                    <label for="sizebutton" class="form-label"><b>Size:</b></label><br>
                    <button class="btn btn-warning text-white rounded-pill  mt-2" id="sizebutton" value="XS">
                        X-Small
                    </button>
                    <button class="btn btn-warning text-white rounded-pill mt-2" id="sizebutton" value="S">
                        Small
                    </button>
                    <button class="btn btn-warning text-white rounded-pill mt-2" id="sizebutton" value="M">
                        Medium
                    </button>
                    <button class="btn btn-warning text-white rounded-pill mt-2" id="sizebutton" value="L">
                        Large
                    </button>
                    <button class="btn btn-warning text-white rounded-pill mt-2" id="sizebutton" value="XL">
                        X-Large
                    </button>
                  </div>
                <div class="list-group-item text-white mt-4 mb-4">
                    <!-- slider to get products of a secific price -->
                    <label for="customRange2" class="form-label"><b>Specific price:</b></label>
                    <br>
                    <input type="range" class=" slider form-range w-50 mt-2" min="0" max="100" value="100" id="customRange2" oninput="volume.value = customRange2.value">
                    <output class="bg-white text-muted text-center rounded-pill w-50" for="customRange2" id="volume">100</output>
                </div>
                <div class="list-group-item text-white mt-4 ">
                    <!-- button filyters for gender -->
                    <label for="genderbutton" class="form-label"><b>Gender:</b></label><br>
                    <button class=" gender btn btn-warning text-white rounded-pill  mt-2" id="genderbutton" value="Unisex">
                        Unisex   <i class="fas fa-genderless"></i>
                    </button>
                    <button class=" gender btn btn-warning text-white rounded-pill  mt-2" id="genderbutton" value="Female">
                        Female   <i class="fas fa-venus"></i>
                    </button>
                    <button class=" gender btn btn-warning text-white rounded-pill  mt-2" id="genderbutton" value="Male">
                        Male   <i class="fas fa-mars"></i>
                    </button>
                </div>
                <div class="list-group-item text-white mt-4 mb-4">
                    <!-- button to clear filters and show all products -->
                    <button class="btn btn-light rounded-circle mt-4 text-warning " data-checked='false' id="btn"><u>Clear</u></button>
                </div>
            </div>
            <div><h4 class="text-center text-white pr-4">Products </h4></div>
        </div>

        
        <!-- table will old each product in each row -->
        <table class="table">
            <tbody class="mt-4" id="myTable">
                <% if(data.length){
                for(var i = 0; i< data.length; i++) {%>  
                <!-- the row of product -->
                <tr data-port3=<%= data[i].pGender%> data-port2=<%= data[i].pSize%> data-port=<%= data[i].pPrice%> >
                    <td>
                        <!-- procuct image that can be enlarged as a modal -->
                        <a href="#" class="pop">
                            <img src="<%= data[i].pImage%>" alt="products" id="product_img" class="mt-3">
                            <div class="bottom-left text-warning"><h6>Click to enlarge    <i class="fas fa-search-plus"></i></h6></div>
                        </a>
                    </td>
                    <td>
                        <!-- name of product -->
                        <b><h5 id="td"> <%= data[i].pName%></h5></b>
                    </td>
                    <td>
                        <!-- gender -->
                        <h5 class="font-weight-light" id="td">Gender:<br><i><%= data[i].pGender%></i></h5>
                    </td>
                    <td>
                        <!-- price -->
                        <h5 class="font-weight-light" id="td">Price:<br><i>$<%= data[i].pPrice%></i></h5>
                    </td>
                    <td>
                        <!-- size -->
                        <h5 class="font-weight-light mr-4" id="td">Size:<br><i><%= data[i].pSize%></h5>
                    </td>
                    <td>
                        <!-- quantity selector -->
                        <div class="sp-quantity" id="td">
                            <div class="sp-plus fff rounded-right btn-warning"> <a class="ddd text-white" href="#" onclick="modifyQuantity(+1, '<%=data[i].pId%>')"><h5>+</h5></a></div>
                                <div class="sp-input">
                                    <input type="text" id="quntity-input<%=data[i].pId%>" class="quntity-input" value="1" />
                                </div>
                            <div class="sp-minus fff rounded-left btn-warning"> <a class="ddd text-white" href="#" onclick="modifyQuantity(-1, '<%=data[i].pId%>')"><b>-</b></a></div>
                        </div>
                    <td>
                        <!-- add to basket -->
                        <a onclick="myFunction(<%=data[i].pId%>)" class="btn rounded-circle btn-warning text-white edit p-4 mr-4" id="td" ><b><i class="fas fa-plus"></i></b></a>                       
                    </td>
                </tr>
                    <!-- if ther are no products available diplsay -->
                    <% }
                        }else{ %>
                        <tr>
                            <td colspan="3">No products</td>
                        </tr>
                    <% } %>    
            </tbody>
        </table>
          
        <!-- modal the displays the image when clicked -->
        <div class="modal fade" id="imagemodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">              
                <div class="modal-body">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <img src="" class="imagepreview" style="width: 100%;" >
                </div>
              </div>
            </div>
        </div>

        <!-- footer -->
        <footer class="text-center text-lg-start">
            <div class="text-center p-3">
                Â© 2021 Copyright:
                <a class="text-dark" href="/">Moda.ie</a>
            </div>
        </footer>
    </body>
</html>
    
    <!-- table search to filer all contents of table -->
    <script>
        $(document).ready(function(){
            $('#myInput').val(" ");
            $("#myInput").on("keyup", function() {
                var value = $(this).val().toLowerCase();
                $("#myTable tr").filter(function() {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
            });
        });
    </script>

    <!-- size buttons - shows rows with the selected size-->
    <script>
        $('button').click(function() {
            
            var port = $(this).val()
            
            if ( port !== '' ) {
            $("tr[data-port2!=" + port+ "]").css('visibility', 'collapse');
            $("tr[data-port2=" + port+ "]").css('visibility', 'visible');
            } else {
            $("tr").css('visibility', 'visible');
            }
        });
    </script>
    
    

    <!-- filtering the products based on exact price by sliding the slider -->
    <script>
        $('.slider').click(function() {
            var port = $(this).val()
            console.log( port )
            if ( port !== '' ) {
                $("tr[data-port!=" + port+ "]").css('visibility', 'collapse');
                $("tr[data-port=" + port+ "]").css('visibility', 'visible');
            } else {
                $("tr").css('visibility', 'visible');
            }
        });
    </script>

    <!-- gender button - filtering based on gender -->
    <script>
        $('.gender').click(function() {
            
            var port = $(this).val()

            if ( port !== '' ) {
            $("tr[data-port3!=" + port+ "]").css('visibility', 'collapse');
            $("tr[data-port3=" + port+ "]").css('visibility', 'visible');
            } else {
            $("tr").css('visibility', 'visible');
            }
        });
    </script>

    
    <!-- clearing filers -->
    <script>
        $(document).ready(function () {
            $("#btn").on("click", function() {
                $("#myTable tr").show()
                $("tr").css('visibility', 'visible');
                $('#myInput').val(' ');
                document.getElementById("customRange2").value = "100";
                document.getElementById("volume").value = "100";
            });
        });
    </script>
    
    <!-- modal to enlarge the product images -->
    <script>
        $(function() {
            $('.pop').on('click', function() {
                $('.imagepreview').attr('src', $(this).find('img').attr('src'));
                $('#imagemodal').modal('show');   
            });		
        });
    </script>

    <!-- not allowing quantity to not go below 0 -->
    <script>
        function modifyQuantity(i, id)
        {
            var currentQuantity = parseInt($("#quntity-input" + id).val());
            var newQuantity = currentQuantity + i;

            $("#quntity-input" + id).val(newQuantity);

            // if (currentQuantity > 0) {
            //     newQuantity = $("#quntity-input" + id).val(newQuantity);
            // } else {
            //     newQuantity = 1;
            // }

        }

        function myFunction(id) {

            quantity = parseInt($("#quntity-input" + id).val());
            // alert(quantity);

            window.location.href = "http://localhost:8000/products/add/"+id+"/"+quantity;
        }
    </script>
